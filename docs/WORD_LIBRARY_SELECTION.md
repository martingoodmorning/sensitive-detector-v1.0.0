# 敏感词库选择功能

## 概述

敏感词库选择功能允许用户根据需要选择不同的敏感词库进行检测，支持单选和多选模式。该功能提供了完整的词库管理界面，包括创建、编辑、删除词库等操作。

## 功能特性

### 1. 词库管理
- **创建词库**：支持创建自定义敏感词库
- **编辑词库**：可以修改现有词库的敏感词内容
- **删除词库**：支持删除不需要的词库
- **词库列表**：显示所有可用词库的详细信息

### 2. 词库选择
- **单选模式**：选择单个词库进行检测
- **多选模式**：同时选择多个词库进行检测
- **默认词库**：当未选择任何词库时使用系统默认词库
- **实时更新**：词库选择后立即生效

### 3. 检测集成
- **文本检测**：支持在文本检测时选择词库
- **文档检测**：支持在文档检测时选择词库
- **规则匹配**：与规则匹配引擎（预处理+AC+DFA）完全集成

## API接口

### 词库管理API

#### 获取词库列表
```
GET /word-libraries
```

响应格式：
```json
{
  "status": "success",
  "data": [
    {
      "id": "词库名称",
      "name": "词库名称",
      "filename": "词库名称.txt",
      "path": "/app/word_libraries/词库名称.txt",
      "word_count": 100,
      "created_time": "2025-01-01T00:00:00",
      "modified_time": "2025-01-01T00:00:00",
      "size": 2048
    }
  ]
}
```

#### 创建词库
```
POST /word-libraries
```

请求体：
```json
{
  "name": "词库名称",
  "words": ["敏感词1", "敏感词2", "敏感词3"]
}
```

#### 获取词库内容
```
GET /word-libraries/{name}
```

#### 更新词库
```
PUT /word-libraries/{name}
```

请求体：
```json
{
  "words": ["新敏感词1", "新敏感词2", "新敏感词3"]
}
```

#### 删除词库
```
DELETE /word-libraries/{name}
```

### 检测API更新

#### 文本检测（支持词库选择）
```
POST /detect/text
```

请求体：
```json
{
  "text": "检测文本",
  "library_names": ["词库1", "词库2"]  // 可选
}
```

#### 文档检测（支持词库选择）
```
POST /detect/document
```

表单数据：
- `file`: 上传的文件
- `library_names`: 词库名称（逗号分隔，可选）

## 前端界面

### 1. 词库选择区域
- 多选下拉框显示所有可用词库
- 实时显示已选择的词库信息
- 刷新按钮更新词库列表

### 2. 词库管理面板
- 词库列表显示详细信息
- 创建、编辑、删除操作按钮
- 词库编辑器支持批量编辑敏感词

### 3. 检测结果显示
- 显示使用的词库信息
- 规则匹配详细结果
- 兼容旧版本API格式

## 使用示例

### 1. 创建自定义词库
1. 进入"词库管理"标签页
2. 点击"创建新词库"按钮
3. 输入词库名称和敏感词列表
4. 点击"保存"完成创建

### 2. 选择词库进行检测
1. 在文本检测或文档检测页面
2. 从词库选择下拉框中选择需要的词库
3. 支持多选，可同时选择多个词库
4. 进行检测，系统将使用选中的词库

### 3. 编辑现有词库
1. 在词库管理页面找到要编辑的词库
2. 点击"编辑"按钮
3. 修改敏感词列表
4. 点击"保存"完成更新

## 技术实现

### 后端实现
- **WordLibraryManager类**：词库管理器，处理文件操作
- **ThreeStepFilter类**：支持动态加载多个词库
- **RESTful API**：标准的HTTP接口设计

### 前端实现
- **词库选择组件**：多选下拉框和状态显示
- **词库管理界面**：完整的CRUD操作界面
- **API集成**：与后端API的完整集成

### 数据存储
- 词库文件存储在`/app/word_libraries/`目录
- 每个词库对应一个`.txt`文件
- 文件格式：每行一个敏感词，UTF-8编码

## 配置说明

### 环境变量
- `SENSITIVE_WORDS_PATH`：默认敏感词库路径
- 词库文件路径：`/app/word_libraries/`

### 文件权限
- 确保应用有读写词库目录的权限
- 词库文件使用UTF-8编码

## 注意事项

1. **词库名称唯一性**：每个词库名称必须唯一
2. **文件编码**：所有词库文件必须使用UTF-8编码
3. **敏感词格式**：每行一个敏感词，自动去除首尾空白
4. **性能考虑**：大量词库可能影响检测性能
5. **数据备份**：建议定期备份词库文件

## 扩展功能

### 未来可能的增强
- 词库导入/导出功能
- 词库分类和标签
- 词库使用统计
- 词库版本管理
- 词库共享功能
